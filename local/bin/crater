#!/bin/bash

declare FORMAT_SUCCESS="\e[1;32m[SUCCESS]"
declare FORMAT_ERROR="\e[1;31m[ERROR]"
declare FORMAT_TITLE="\e[0;34m"
declare FORMAT_RESET="\e[0m"

declare TEMPLATES_PATH="$HOME/.local/share/crater"

function help() {
	printf "
${FORMAT_TITLE}USAGE:${FORMAT_RESET}
    $(basename $0) [FILE TYPE] [FILE NAME] [TEMPLATE TYPE]

${FORMAT_TITLE}DESCRIPTION:${FORMAT_RESET}
    Creates a default file in a specific programming language.

${FORMAT_TITLE}ARGUMENTS:${FORMAT_RESET}
    FILE TYPE              bash, c, c++, go, html, java, latex, lua, python, rust.
    FILE NAME              (Optional) The name of the file.
    TEMPLATE TYPE          (Optional) basic, code, academic.

${FORMAT_TITLE}EXAMPLES:${FORMAT_RESET}
    $(basename $0) html index
    $(basename $0) python
    $(basename $0) c++ wordFinder code

${FORMAT_TITLE}REPORTING BUGS:${FORMAT_RESET}
    Report issues at: https://github.com/druxorey/dotfiles/issues

"
	exit 0
}


function main() {
	fileType=$1
	shift
	fileName="default"

	while getopts "n:h" opt; do
	case $opt in
		n) fileName="$OPTARG" ;;
		h) help ;;
		*) exit 1 ;;
	esac
	done

	case $fileType in
		"bash") extension="sh";;
		"c") extension="c";;
		"c++") extension="cpp";;
		"cpp") extension="cpp";;
		"golang") extension="go";;
		"go") extension="go";;
		"html") extension="html";;
		"java") extension="java";;
		"latex") extension="tex";;
		"lua") extension="lua";;
		"python") extension="py";;
		"rust") extension="rs";;
		"sh") extension="sh";;
		"shell") extension="sh";;
		"tex") extension="tex";;
		*)
			printf "${FORMAT_ERROR} File type '%s' not found.${FORMAT_RESET}\n" "$fileType"
			exit 1
		;;
	esac

	files=()
	for file in "$TEMPLATES_PATH/$extension"/*; do
		files+=("$file")
	done

	printf "Available templates with extension '%s':\n" "$extension"
	for index in "${!files[@]}"; do
		if [[ -d ${files[$index]} ]]; then
			printf "  [%d] ${FORMAT_TITLE}%s/${FORMAT_RESET}\n" "$index" "$(basename "${files[$index]}")"
		else
			printf "  [%d] %s\n" "$index" "$(basename "${files[$index]}")"
		fi
	done

	printf "Enter the number corresponding to the file index: "
	read -r ans

	if ! [[ "$ans" =~ ^[0-9]$ ]]; then
		printf "${FORMAT_ERROR} Invalid input: '%s'${FORMAT_RESET}\n" "$ans"
		exit 1
	fi

	if [[ -d ${files[$ans]} ]]; then
		newFileName="${fileName}"
	else
		newFileName="${fileName}.${extension}"
	fi

	cp -rp "${files[$ans]}" "$newFileName" || {
		printf "${FORMAT_ERROR} Failed to create file '%s'${FORMAT_RESET}\n" "$newFileName"
		exit 1
	}

	if [[ -s $newFileName ]]; then
		printf "${FORMAT_SUCCESS} File '%s' created${FORMAT_RESET}\n" "$newFileName"
	else
		printf "${FORMAT_ERROR} Failed to create file '%s'${FORMAT_RESET}\n" "$newFileName"
	fi

	exit 0
}

main "$@"
